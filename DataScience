import csv

data = "netflix.csv"
export_data = "releases_per_month.csv"

counter_all = 0
counter_month = 0
counter_all_month_movies = 0
counter_all_month_series = 0
counter_movies = 0
counter_series = 0

percent_movies_all = 0
percent_series_all = 0
percent_movies = 0
percent_series = 0

monate = ['January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December']

cache = []
export = []

with (open(data, "r", encoding="utf-8", errors="ignore") as file):
    reader = csv.reader(file)

    for i in reader:
        counter_all += 1

        if i[1].lower() == 'movie':
            percent_movies_all += 1
        else:
            percent_series_all += 1

    percent_movies_all = (percent_movies_all / counter_all) * 100
    percent_series_all = (percent_series_all / counter_all) * 100

for year in range(2000, 2024, 1):
    for month in monate:
        with (open(data, "r", encoding="utf-8", errors="ignore") as file):
            reader = csv.reader(file)

            for row in reader:

                if month.lower() in row[6].lower() and str(year).lower() in row[6].lower():
                    if row[1].lower() == 'movie':
                        counter_movies += 1
                    else:
                        counter_series += 1
                    counter_month += 1

        if counter_all == 1:
            print(f"Die Suche hat leider keine Treffer ergeben !")
        else:

            counter_all_month_movies = counter_all_month_movies + counter_movies
            counter_all_month_series = counter_all_month_series + counter_series
            if counter_movies != 0:
                percent_movies = (counter_movies / counter_month) * 100
                percent_series = 100 - percent_movies

            if counter_month != 0:
                print(f"{month.upper()} | {year} | Gesamt {counter_month} | "
                      f"Filme: {counter_movies} | Serien: {counter_series} | "
                      f"[{round(percent_movies, 2)}%] | [{round(percent_series, 2)}%]")

            cache.append(month)
            cache.append(year)
            cache.append(counter_month)
            cache.append(counter_movies)
            cache.append(counter_series)

            export.append(cache)

            cache = []

        counter_month, counter_series, counter_movies, percent_series, percent_movies = 0, 0, 0, 0, 0

with open(export_data, 'w', newline='') as file:
    writer = csv.writer(file)

    backup_movies = 0
    backup_series = 0
    backup_gesamt = 0

    for item in export:
        writer.writerow(item)

        backup_movies = backup_movies + item[3]
        backup_series = backup_series + item[4]

    backup_gesamt = backup_gesamt + backup_series + backup_movies

print(f"\nInsgesamt wurden {counter_all} Datens√§tze durchsucht,\n"
      f"{backup_gesamt} sind davon Valide!\n"
      f"\n"
      f"{backup_movies} Filme und {backup_series} Serien!\n"
      f"{round(percent_movies_all, 2)}% sind Filme\n"
      f"{round(percent_series_all, 2)}% sind Serien!")
